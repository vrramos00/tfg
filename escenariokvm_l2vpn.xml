<?xml version="1.0" encoding="UTF-8"?>


<vnx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="/usr/share/xml/vnx/vnx-2.00.xsd">
	<global>
    <version>2.0</version>
    <scenario_name>escenario_vpls</scenario_name>
    <!--ssh_key>~/.ssh/id_dsa.pub</ssh_key-->
    <automac/>
    <!--vm_mgmt type="none" /-->
    <vm_mgmt type="private" network="10.250.0.0" mask="24" offset="200">
       <host_mapping />
    </vm_mgmt>
    <vm_defaults>
        <console id="0" display="no"/>
        <console id="1" display="yes"/>
    </vm_defaults>
	   

    <help>
        <seq_help seq='start-www'>Start apache2 web server</seq_help>
        <seq_help seq='stop-www'>Stop apache2 web server</seq_help>
    </help>

  </global>
  
  <net name="NetCE1APE1" mode="virtual_bridge"/>
  <net name="NetCE2APE2" mode="virtual_bridge"/>
  <net name="NetCE1BPE2" mode="virtual_bridge"/>
  <net name="NetCE3APE3" mode="virtual_bridge"/>
  <net name="NetCE2BPE1" mode="virtual_bridge"/>

  <net name="NetP1PE1" mode="virtual_bridge" mtu="1540"/>
  <net name="NetP2PE2" mode="virtual_bridge" mtu="1540"/>
  <net name="NetP2PE3" mode="virtual_bridge" mtu="1540"/> 
  <net name="NetP1P2" mode="virtual_bridge" mtu="1540"/>
  
  <vm name="PE1" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetCE1APE1"/>
    <if id="2" net="NetP1PE1">
        <ipv4>10.0.10.1/24</ipv4>
    </if>
    <if id="3" net="NetCE2BPE1"/>
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/root/">conf/PE1</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
	echo 'set reassemble no' >> /etc/pf.conf
        chmod +x /root/PE1/start.interfaces
        cp /root/PE1/ldpd.conf /etc
        cp /root/PE1/ospfd.conf /etc
        chmod 0640 /etc/ldpd.conf
        chmod 0640 /etc/ospfd.conf
        /root/PE1/start.interfaces
    </exec>
  </vm>

  <vm name="PE2" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetCE2APE2"/>
    <if id="2" net="NetCE1BPE2"/>
    <if id="3" net="NetP2PE2">
         <ipv4>10.0.20.1/24</ipv4>
    </if>
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/root/">conf/PE2</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
	echo 'set reassemble no' >> /etc/pf.conf
        chmod +x /root/PE2/start.interfaces
        cp /root/PE2/ldpd.conf /etc
        cp /root/PE2/ospfd.conf /etc
        chmod 0640 /etc/ldpd.conf
        chmod 0640 /etc/ospfd.conf
        /root/PE2/start.interfaces
    </exec>
 </vm> 

  <vm name="PE3" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetCE3APE3"/>
    <if id="2" net="NetP2PE3">
         <ipv4>10.0.30.1/24</ipv4>
    </if>
    <forwarding type="ip" />
    <filetree seq="on_boot" root="/root/">conf/PE3</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
	echo 'set reassemble no' >> /etc/pf.conf
        chmod +x /root/PE3/start.interfaces
        cp /root/PE3/ldpd.conf /etc
        cp /root/PE3/ospfd.conf /etc
        chmod 0640 /etc/ldpd.conf
        chmod 0640 /etc/ospfd.conf
        /root/PE3/start.interfaces
    </exec>
  </vm>

  <vm name="P2" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetP1P2">
         <ipv4>10.0.40.2/24</ipv4>
    </if>
    <if id="2" net="NetP2PE2">
         <ipv4>10.0.20.2/24</ipv4>
    </if>
    <if id="3" net="NetP2PE3">
         <ipv4>10.0.30.2/24</ipv4>
    </if>
   <forwarding type="ip" />
   <filetree seq="on_boot" root="/root/">conf/P2</filetree>
   <exec seq="on_boot" type="verbatim" ostype="system">
        chmod +x /root/P2/start.interfaces
        cp /root/P2/ldpd.conf /etc
        cp /root/P2/ospfd.conf /etc
        chmod 0640 /etc/ldpd.conf
        chmod 0640 /etc/ospfd.conf
        /root/P2/start.interfaces
   </exec>
  </vm>

  <vm name="P1" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetP1PE1">
         <ipv4>10.0.10.2/24</ipv4>
    </if>
    <if id="2" net="NetP1P2">
         <ipv4>10.0.40.1/24</ipv4>
    </if>
   <forwarding type="ip" />
   <filetree seq="on_boot" root="/root/">conf/P1</filetree>
   <exec seq="on_boot" type="verbatim" ostype="system">
        chmod +x /root/P1/start.interfaces
        cp /root/P1/ldpd.conf /etc
        cp /root/P1/ospfd.conf /etc
        chmod 0640 /etc/ldpd.conf
        chmod 0640 /etc/ospfd.conf
        /root/P1/start.interfaces
   </exec>
  </vm>

<vm name="CE1A" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetCE1APE1">
      <ipv4>172.16.1.1/24</ipv4>
    </if>
    <filetree seq="on_boot" root="/root/">conf/CE1A</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
        cp /root/CE1A/hosts /etc
       cp /root/CE1A/pf.conf /etc
        chmod +x /root/CE1A/start.interfaces
        /root/CE1A/start.interfaces
        pfctl -f /etc/pf.conf
        sysctl net.inet.icmp.bmcastecho=1
#        echo 0 > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
    </exec>
  </vm>

<vm name="CE2A" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetCE2APE2">
      <ipv4>172.16.1.2/24</ipv4>
    </if>
    <filetree seq="on_boot" root="/root/">conf/CE2A</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
        cp /root/CE2A/hosts /etc
        cp /root/CE2A/pf.conf /etc
       chmod +x /root/CE2A/start.interfaces
        /root/CE2A/start.interfaces
        pfctl -f /etc/pf.conf
        sysctl net.inet.icmp.bmcastecho=1
 #       echo 0 > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
    </exec>  
  </vm>

<vm name="CE1B" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetCE1BPE2">
      <ipv4>172.16.1.3/24</ipv4>
    </if>
    <filetree seq="on_boot" root="/root/">conf/CE1B</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
        cp /root/CE1B/hosts /etc
       cp /root/CE1B/pf.conf /etc
       chmod +x /root/CE1B/start.interfaces
        /root/CE1B/start.interfaces
        pfctl -f /etc/pf.conf
        sysctl net.inet.icmp.bmcastecho=1
  #      echo 0 > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
    </exec>
  </vm>

<vm name="CE3A" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetCE3APE3">
      <ipv4>172.16.1.4/24</ipv4>
    </if>
    <filetree seq="on_boot" root="/root/">conf/CE3A</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
        cp /root/CE3A/hosts /etc
        cp /root/CE3A/pf.conf /etc
        chmod +x /root/CE3A/start.interfaces
        /root/CE3A/start.interfaces
        pfctl -f /etc/pf.conf
        sysctl net.inet.icmp.bmcastecho=1
   #     echo 0 > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
    </exec>
  </vm>

<vm name="CE2B" type="libvirt" subtype="kvm" os="openbsd" arch="x86_64">
    <filesystem type="cow">filesystems/vnx_rootfs_kvm_openbsd64-7.4.qcow2</filesystem>
    <if id="1" net="NetCE2BPE1">
      <ipv4>172.16.1.5/24</ipv4>
    </if>
    <filetree seq="on_boot" root="/root/">conf/CE2B</filetree>
    <exec seq="on_boot" type="verbatim" ostype="system">
        cp /root/CE2B/hosts /etc
        cp /root/CE2B/pf.conf /etc
        chmod +x /root/CE2B/start.interfaces
        /root/CE2B/start.interfaces
         pfctl -f /etc/pf.conf  
        sysctl net.inet.icmp.bmcastecho=1
  #      echo 0 > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
    </exec>
  </vm>

</vnx>
